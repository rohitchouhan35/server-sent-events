<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Streaming</title>
</head>
<body>
<video id="video-player" controls></video>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const videoPlayer = document.getElementById('video-player');
        const eventSource = new EventSource('http://localhost:8080/video-stream');

        eventSource.onmessage = function (event) {
            console.log('Received message from server:', event);

            // Decode Base64-encoded chunk
            const decodedChunk = atob(event.data);
            console.log('Decoded chunk:', decodedChunk);

            // Convert the decoded string to Uint8Array
            const byteArray = new Uint8Array(decodedChunk.length);
            for (let i = 0; i < decodedChunk.length; i++) {
                byteArray[i] = decodedChunk.charCodeAt(i);
            }

            // Create a Blob from Uint8Array
            const blob = new Blob([byteArray], { type: 'video/mp4' });
            console.log('Created Blob:', blob);

            // Append the Blob to the video player
            videoPlayer.src = URL.createObjectURL(blob);
            console.log('Set video player source:', videoPlayer.src);
        };

        eventSource.onerror = function (error) {
            console.error('EventSource failed:', error);
            eventSource.close();
        };

        window.onbeforeunload = function () {
            eventSource.close();
        };
    });
</script>
</body>
</html>
